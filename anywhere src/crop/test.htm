<html>
<head>

<script src="../scripts/jquery-1.8.3.js"></script>
<script src="../session/connections.js"></script>

<script>

           $.url = $.webServer.protocol + "://" + $.webServer.address + ":" + $.webServer.port + "/" + $.webServer.serviceName + "/sendFile/";
           var result = "";

           function sendFile(filename, contentType, data) {
               //filename, contentType,  data
               var contentType = "image"

               //http://localhost:58598/./service/Anywhere.svc/sendFile/

               $.ajax({ type: "POST",
                   url: $.webServer.protocol + "://"  + $.webServer.address + ":" + $.webServer.port + "/" + $.webServer.serviceName + "/sendFile/",
                   data: '{"filename":"'+ filename +'", "contentType":"'+ contentType +'", "data":"'+ data + '"}',
                   contentType: "application/json; charset=utf-8",
                   dataType: "json",
                   success: function (response, status, xhr) {
                   var res = JSON.stringify(response);
                   alert('success: ' + res);
               },
               error: function (xhr, status, error) { alert("Error\n-----\n" + xhr.status + '\n' + xhr.responseText); },
               }); 
               
           }


           function handleFileSelect() {
               if (!window.File || !window.FileReader || !window.FileList || !window.Blob) {
                   alert('The File APIs are not fully supported in this browser.');
                   return;
               }

               input = document.getElementById('fileinput');
               if (!input) {
                   alert("Um, couldn't find the fileinput element.");
               }
               else if (!input.files) {
                   alert("This browser doesn't seem to support the `files` property of file inputs.");
               }
               else if (!input.files[0]) {
                   alert("Please select a file before clicking 'Load'");
               }
               else {
                   file = input.files[0];

                   alert(file.size);

                   fr = new FileReader();
                   fr.onload = receivedText;
                   //fr.readAsText(file);
                   fr.readAsDataURL(file);
                   //fr.readAsBinaryString(file);
                   
               }
           }

           function receivedText() {
               result = fr.result;
               resultarr = result.split(',');
               //document.getElementById('editor').appendChild(document.createTextNode(fr.result))
               //alert(escape(file.name) + " | " + file.type + " | " + resultarr[1]);

               sendFile(escape(file.name) , file.type , resultarr[1]);

           }           

        </script>

</head>

<body>


<hr />

<input type="file" id="fileinput" onchange='handleFileSelect();'/>
<!-- <input type='button' id='btnLoad' value='Load' onclick='handleFileSelect();'> -->
<div id="editor"></div>

</body>
</html>



